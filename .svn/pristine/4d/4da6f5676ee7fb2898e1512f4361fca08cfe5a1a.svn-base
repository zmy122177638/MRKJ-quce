<?php if (!defined('THINK_PATH')) exit();?><!DOCTYPE html>
<html>
  <head>
	<meta charset="UTF-8">
	<meta http-equiv="X-UA-Compatible" content="ie=edge,chrome=1">
	<meta name="viewport" content="width=device-width,initial-scale=1.0, user-scalable=0, minimum-scale=1.0, maximum-scale=1.0">
	<meta name="apple-mobile-web-app-capable" content="yes">
	<meta name="apple-touch-fullscreen" content="yes">
	<meta name="format-detection" content="telephone=no">
	<title>趣味心理测试</title>
	<!-- <link rel="Shortcut Icon" href="网站.ico图标路径" /> -->
	<!--[if lt IE 9]>  
		<script src="http://cdn.bootcss.com/html5shiv/r29/html5.js"></script>
		<script src="https://cdn.bootcss.com/respond./quce/Public/js/1.4.2/respond.min.js"></script>    
	<![endif]-->
	
	<link rel="stylesheet" href="/quce/Public/css/common.css">
	<link rel="stylesheet" href="/quce/Public/css/_index.css">
	<link rel="stylesheet" href="/quce/Public/css/swiper.min.css">
    <script type="text/javascript">var cnzz_protocol = (("https:" == document.location.protocol) ? " https://" : " http://");document.write(unescape("%3Cspan style='display:none;' id='cnzz_stat_icon_1273942614'%3E%3C/span%3E%3Cscript src='" + cnzz_protocol + "s19.cnzz.com/z_stat.php%3Fid%3D1273942614' type='text/javascript'%3E%3C/script%3E"));</script>
    <script src="/quce/Public/js/rem.js"></script>
	<script src="/quce/Public/js/vue.min.js"></script>
	<script src="/quce/Public/js/jquery.min.js"></script>
	<script src="/quce/Public/js/Headroom.js"></script>
	<script src="/quce/Public/js/swiper.min.js"></script>
  </head>
  <body>
	<div id="app">
		<!-- 头部 -->
		<header class="animated">
    <nav>
        <a href="<?php echo U('Index/index','',false);?>" class="navigate <?php echo ($head=='index' ? 'active':''); ?>">首页</a>
        <a href="<?php echo U('Index/mytest','',false);?>" class="navigate <?php echo ($head=='mytest' ? 'active':''); ?>">我的历史</a>
        <?php if($channel == 'qudao150'): else: ?>
            <a href="<?php echo U('Login/index','',false);?>" class="navigate <?php echo ($head=='login' ? 'active':''); ?>">我的</a><?php endif; ?>

        <!--active-->
    </nav>
</header>
		<div class="index_container">
			<!-- banner -->
			<div class="index_banner">
				<div class="swiper-container">
					<div class="swiper-wrapper">


                        <?php if(is_array($bannerArr)): foreach($bannerArr as $key=>$value): ?><div class="swiper-slide"><a href="<?php echo U('Index/palace','',false);?>?subject=<?php echo ($value['subject']); ?>" class="swiper_btn" target="_blank"><img src="/quce/Public/images/<?php echo ($value['image']); ?>" width="100%" alt=""></a></div><?php endforeach; endif; ?>

					</div>
					<div class="swiper-pagination"></div>
				</div>
			</div>
			<!-- 专业命理 -->
			<section>
				<div class="Palace">
					<!--<h3 class="public_title"><span class="p_text">专业命理测算</span><a href="javascript:;">更多 ></a></h3>-->
					<ul class="Palace_wrap">

                        <?php if(is_array($zhimingArr)): foreach($zhimingArr as $key=>$value): ?><li><a href="<?php echo U('Index/palace','',false);?>?subject=<?php echo ($value['subject']); ?>" class="Palace_item" target="_blank">
                        <figure><img src="/quce/Public/images/<?php echo ($value['image']); ?>" class="Palace_img"></figure>
                        <h3 class="Palace_name"><?php echo ($value['name']); ?></h3>
                        </a></li><?php endforeach; endif; ?>

					</ul>

				</div>
			</section>
			<!-- 测试分类 -->
			<section>
				<div class="list_wrap">
					<!--<h3 class="public_title"><span class="p_text">测试分类</span><a href="&lt;!&ndash;{:U('Index/classlist','',false)}&ndash;&gt;">更多 ></a></h3>-->
					<!--<ul class="classlist">-->
						<!--<li><a href="javascript:;">&lt;!&ndash;{$choiceArr[0]['name']}&ndash;&gt;</a></li>-->
						<!--<li><a href="javascript:;">&lt;!&ndash;{$choiceArr[1]['name']}&ndash;&gt;</a></li>-->
						<!--<li><a href="javascript:;">&lt;!&ndash;{$choiceArr[2]['name']}&ndash;&gt;</a></li>-->
						<!--<li><a href="javascript:;">&lt;!&ndash;{$choiceArr[3]['name']}&ndash;&gt;</a></li>-->
						<!--<li><a href="javascript:;">&lt;!&ndash;{$choiceArr[4]['name']}&ndash;&gt;</a></li>-->
						<!--<li><a href="javascript:;">&lt;!&ndash;{$choiceArr[5]['name']}&ndash;&gt;</a></li>-->
						<!--<li><a href="javascript:;">&lt;!&ndash;{$choiceArr[6]['name']}&ndash;&gt;</a></li>-->
						<!--<li><a href="javascript:;">&lt;!&ndash;{$choiceArr[7]['name']}&ndash;&gt;</a></li>-->
					<!--</ul>-->

					<div class="list_container">
						<div class="swiper-container1">
							<div class="swiper-wrapper">
								<div class="swiper-slide"><a href="<?php echo U('Zodiac/zodiacIndex','',false);?>" class="list_btn"><img src="/quce/Public/images/public/sxYunshi.png" alt=""></a></div>
                                <div class="swiper-slide"><a href="<?php echo U('Zodiac/xzpeidui','',false);?>" class="list_btn"><img src="/quce/Public/images/public/peidui.png" alt=""></a></div>
                                <div class="swiper-slide"><a href="<?php echo U('Zodiac/zgjm','',false);?>" class="list_btn"><img src="/quce/Public/images/public/zgjm.png" alt=""></a></div>
                                <div class="swiper-slide"><a href="<?php echo U('Zodiac/xzYunshi','',false);?>" class="list_btn"><img src="/quce/Public/images/public/xzYunshi.png" alt=""></a></div>
                            </div>
						</div>
					</div>
				</div>
			</section>
			<!-- 全部测试 -->
			<section>
				<div class="major">
					<h3 class="public_title"><span class="p_text">全部测试</span></h3>
					<div class="tab">
						<div :class="currtab==0?'curr':'navigatetwo'"  @click="setTapEvent(0)">最热</div>
						<div :class="currtab==1?'curr':'navigatetwo'"  @click="setTapEvent(1)">最新</div>
					</div>
					<div v-show="currtab==0" class="qc_classlist">
						<!-- 最火 -->
						<ul>
							<li v-for="item in HottestData" :key="item.id" >
								<a :href="subject+'?subject='+item.subject" class="Hot_item" target="_blank" >
									<div class="H_left">
										<figure>
											<img :src="item.typeImg" v-if="item.typeImg != null"  class="type_icon" alt="" >
											<img :src="'/quce/Public/images/quce/'+item.title_img" class="t_icon" alt="">
										</figure>
										<div class="H_center">
											<p class="H_title">{{item.title}}</p>
											<p class="H_hot"><span>{{item.hotstar}}万人在测</span></p>
											<p class="H_direction">{{item.content}}</p>
										</div>
									</div>
									<div class="H_right">
										<button class="navigate_btn">去测 ></button>
									</div>
								</a>
							</li>
						</ul> 
						<!-- 加载 -->
						<div class="loadPoint" v-show="loadPoint">
							<img src="/quce/Public/images/loading.gif" v-if="loadtext=='加载中...'" class="load_gif" alt="">{{loadtext}}
						</div>
					</div>
					
					<div v-show="currtab==1" class="qc_classlist">
						<!-- 最新 -->
						<ul>
							<li v-for="item in NewesttData" :key="item.id" >
								<a :href="subject+'?subject='+item.subject" target="_blank" class="Hot_item" >
									<div class="H_left">
										<figure>
											<img :src="item.typeImg" v-if="item.typeImg != null" class="type_icon" alt="" >
											<img :src="'/quce/Public/images/quce/'+item.title_img" class="t_icon" alt="">
										</figure>
										<div class="H_center">
											<p class="H_title">{{item.title}}</p>
											<p class="H_hot"><span>{{item.hotstar}}万人在测</span></p>
											<p class="H_direction">{{item.content}}</p>
										</div>
									</div>
									<div class="H_right">
										<button class="navigate_btn">去测 ></button>
									</div>
								</a>
							</li>
						</ul> 
						<!-- 加载 -->
						<div class="loadPoint" v-show="loadPoint1">
							<img src="/quce/Public/images/loading.gif" v-if="loadtext1=='加载中...'" class="load_gif" alt="">{{loadtext1}}
						</div>
					</div>
				
				</div>
				
			</section>
			<!-- 更新内容弹窗 -->
			<!--<div class="ready_container" v-show="ready_tc_show">-->
				<!--<div class="ready_wrap" :class="{'RscaleOpen':RscaleOpen,'RscaleClose':RscaleClose}">-->
					<!--<div class="ready_title">已更新&lt;!&ndash;{:count($newArr)}&ndash;&gt;条测试</div>-->
					<!--<div class="ready_content">-->
						<!--<ul class="ready_ul_list">-->

                            <!--<?php if(is_array($newArr)): foreach($newArr as $key=>$value): ?>-->
                                <!--<li><a href="&lt;!&ndash;{:U('Index/palace','',false)}&ndash;&gt;?subject=&lt;!&ndash;{$value['subject']}&ndash;&gt;" target="_blank">&lt;!&ndash;{$value['title']}&ndash;&gt; </a></li>-->
                            <!--<?php endforeach; endif; ?>-->

						<!--</ul>-->
						<!--<div class="ready_btn"><a href="javascript:;">查看全部更新</a></div>-->
					<!--</div>-->
					<!--<div class="ready_close_btn" @click="readyCloseEvent()"></div>-->
					<!--<div class="ready_title_icon">New</div>-->
				<!--</div>-->
			<!--</div>-->

			<!-- gotop -->
			<div id="goTop" @click="scrollTopEvent()"></div>
		</div>
		
	</div>
	<script>
		// var HottestData = [
		//     {id:'1',url:'/chartCS',imgPath:'https://ss2.bdstatic.com/70cFvnSh_Q1YnxGkpoWK1HF6hhy/it/u=3389767249,1940293781&fm=27&gp=0.jpg',title:'深度个人占星',hotStar:"19.2",direction:'个人星盘分析，透彻解读你的命运！'},
		//     {id:'2',url:'/chartCS',imgPath:'https://ss2.bdstatic.com/70cFvnSh_Q1YnxGkpoWK1HF6hhy/it/u=3389767249,1940293781&fm=27&gp=0.jpg',title:'深度个人占星',hotStar:"19.2",direction:'个人星盘分析，透彻解读你的命运！'},
		//     {id:'3',url:'/chartCS',imgPath:'https://ss2.bdstatic.com/70cFvnSh_Q1YnxGkpoWK1HF6hhy/it/u=3389767249,1940293781&fm=27&gp=0.jpg',title:'深度个人占星',hotStar:"19.2",direction:'个人星盘分析，透彻解读你的命运！'},
		// ]

		// var NewesttData = [
		//     {id:'1',url:'/chartCS',imgPath:'https://ss2.bdstatic.com/70cFvnSh_Q1YnxGkpoWK1HF6hhy/it/u=3389767249,1940293781&fm=27&gp=0.jpg',title:'深度个人占星',hotStar:"19.2",direction:'个人星盘分析，透彻解读你的命运！'},
		//     {id:'2',url:'/chartCS',imgPath:'https://ss2.bdstatic.com/70cFvnSh_Q1YnxGkpoWK1HF6hhy/it/u=3389767249,1940293781&fm=27&gp=0.jpg',title:'深度个人占星',hotStar:"19.2",direction:'个人星盘分析，透彻解读你的命运！'},
		// ]
		var subject="<?php echo U('Index/palace','',false);?>";
		
		var vm = new Vue({
			el:'#app',
			data:{
				Hotpage:1,
				NewPage:1,
				currtab:0,
				readyData:[],
				ready_tc_show:false,
				RscaleOpen:false, 
				RscaleClose:false,
				HottestData:[],
				NewesttData:[],
				subject:subject,
				loadPoint:false,
				loadPoint1:false,
				throttleB:true,
				loadtext:'加载中...',
				loadtext1:'加载中...',
			},
			mounted(){
				this.getsubjectData();
				this.loadpluginEvent();
				this.readyOpenEvent();
				window.addEventListener('scroll',this.scrollBottomEvent,true);
			},
			methods:{
				// 获取数据
				getsubjectData(){
					var _self = this;
					$.get("<?php echo U('Index/indexAnswer','',false);?>",{page:_self.Hotpage},function(data){
						var data = JSON.parse(data);
						_self.HottestData = data;
						console.log(_self.HottestData)
					});
					$.get("<?php echo U('Index/indexAnswerNew','',false);?>",{page:_self.NewPage},function(data){
						var data = JSON.parse(data);
						_self.NewesttData = data;
						console.log(_self.NewesttData)
					})
				}, 
				// loadplugin
				loadpluginEvent(){
					// headroom 
					var headroom = new Headroom(document.querySelector('header'), {
						"tolerance": 8,
						"offset": 205,
						"classes": {
							"initial": "animated",
							"pinned": "slideInDown",
							"unpinned": "slideOutUp"
						}
					});
					headroom.init();// headroom.destroy(); 销毁实例

					var headroom1 = new Headroom(document.querySelector('#goTop'), {
						"tolerance": 8,
						"offset": 205,
						"classes": {
							"initial": "animated",
							"pinned": "bounceIn",
							"unpinned": "bounceOut"
						}
					});
					headroom1.init();// headroom.destroy(); 销毁实例

					//swiper轮播
					var swiper = new Swiper('.swiper-container', {
						loop:true,
						effect : 'fade',
						autoplay:{
							disableOnInteraction:false,
							delay: 3000,
							stopOnLastSlide: false,
						},
						pagination: {
							el: '.swiper-pagination',
							clickable: true,
						},
					});
					
					// swiper分类
					var swiper = new Swiper('.swiper-container1', {slidesPerView:'auto',});
				},
				// 内容更新
				readyOpenEvent(){
					this.ready_tc_show = true;
					this.RscaleOpen = true;
				},
				// 关闭更新内容
				readyCloseEvent(){
					var _self = this;
					_self.RscaleClose = true;
					document.querySelector('.ready_wrap').addEventListener('webkitAnimationEnd',function(){
						_self.ready_tc_show = false;
					})
				},
				// tab切换
				setTapEvent(index){this.currtab = index;},
				// 返回顶部
				scrollTopEvent(){$('html,body').animate({scrollTop:0},700)},
				// 上拉加载
				scrollBottomEvent(){
					var _self = this;
					var scrollTop = document.documentElement.scrollTop || window.pageYOffset|| document.body.scrollTop;
					var scrollHeight = document.body.scrollHeight;
					var screenHeight = window.screen.height;
					if(scrollHeight - scrollTop < screenHeight+1){
						if(_self.currtab == "0"){
							_self.loadPoint = true;
							if(!_self.throttleB){ return;}
							if(_self.throttleB){
								_self.Hotpage++;
								$.get("<?php echo U('Index/indexAnswer','',false);?>",{page:_self.Hotpage},function(data){
									var data = JSON.parse(data);
									console.log(data[0].page)
									if(data[0].content != undefined){
										data.forEach(function (item){
											_self.HottestData.push(item)
										});
									}else{
										_self.loadtext = "没有更多了"
									}
								}); 
								_self.throttleB = false;
								setTimeout(function(){
									_self.throttleB =true;
								},1000)
							}
						}else if(_self.currtab == "1"){
							_self.loadPoint1 = true;
							if(!_self.throttleB){ return;}
							if(_self.throttleB){
								_self.NewPage++;
								$.get("<?php echo U('Index/indexAnswerNew','',false);?>",{page:_self.NewPage},function(data){
									var data = JSON.parse(data);
									console.log(data[0].page)
									if(data[0].content != undefined){
										data.forEach(function (item){
											_self.NewesttData.push(item)
										});
									}else{
										_self.loadtext1 = "没有更多了"
									}
								}); 
								_self.throttleB = false;
								setTimeout(function(){
									_self.throttleB =true;
								},1000)
							}
						}
					}
				},
			}
		})
	</script>
  </body>
</html>